#include<iostream>
#include<time.h>
#include<ctime>
#include<cstdlib>
#include<cmath>
#include<windows.h> 
using namespace std;
int points=0;
bool vita=true;
void selector(unsigned short color)
{
HANDLE hCon = GetStdHandle(STD_OUTPUT_HANDLE); //Per colorare gli oggetti
SetConsoleTextAttribute(hCon,color);
}  
void stampa(char m[29][30]){
	selector(10);
	for(int y=0;y<29;y++){
		for(int x=0;x<30;x++){
			if(m[y][x]=='C'){
				selector(6 | FOREGROUND_INTENSITY); //colora di giallo la c
				cout<<m[y][x];
				selector(10);
			}
				else if(m[y][x]=='N'){
					selector(4| FOREGROUND_INTENSITY);     //Colora di rosso le N
					cout<<m[y][x];
					selector(10);
				}
					else if(m[y][x]=='#'){
						selector(1| FOREGROUND_INTENSITY);  //Colora di blu i muri
						cout<<m[y][x];
						selector(10);
					}
						else if(m[y][x]=='*'){
							selector(10| FOREGROUND_INTENSITY);
							cout<<m[y][x];
							selector(10);
						}
			else{
			cout<<m[y][x];     //Stampa (in verde) le stelline
		}
			if(y==0 and x==29){
				cout<<"     Points: "<<points;
			}
		}
		cout<<endl;
	}
	selector(15);
}
void play(char m[29][30], char scelta){
	bool flag=false;
	bool flag_1=false;
	bool flag_2=false;
	int n;
	int i=0;
	  //Per generare numeri casuali
	for(int y=0;y<29 and flag==false;y++){
		for(int x=0;x<30 and flag==false;x++){
			//Movimento giocatore (C)
			if(m[y][x]=='C'){
				if((scelta=='w' or scelta=='W') and m[y-1][x]!='#'){
					if(m[y-1][x]=='N'){
						vita=false;
					}
					else if(m[y-1][x]=='*'){
							points++;
						}
					m[y][x]=' ';
					m[y-1][x]='C';
					flag=true;
				}
				else if((scelta=='s' or scelta=='S') and m[y+1][x]!='#'){
					if(m[y+1][x]=='N'){
						vita=false;
					}
					else if(m[y+1][x]=='*'){
						points++;
					}
					m[y][x]=' ';
					m[y+1][x]='C';
					flag=true;
				}
				else if ((scelta=='a' or scelta=='A') and m[y][x-1]!='#'){
					if(m[y][x-1]=='N'){
						vita=false;
					}
					else if(m[y][x-1]=='*'){
						points++;}
					m[y][x]=' ';
					m[y][x-1]='C';
					flag=true;
				}
				else if((scelta=='d' or scelta=='D') and m[y][x+1]!='#'){
					if(m[y][x+1]=='N'){
						vita=false;
					}
					if(m[y][x+1]=='*'){
						points++;
					}
					m[y][x]=' ';
					m[y][x+1]='C';
					flag=true;
				}
			}
		}
	}
	for(int y=0;y<29;y++){ //Movimento nemici
		for(int x=0;x<30;x++){
			if(m[y][x]=='N'){
				n= rand() % 4; //nUMERI CASUALI DA 0 A 3
					if(n==0 and m[y-1][x]!='#'and m[y-1][x]!='N'){
						if(m[y-1][x]=='C'){
							vita=false;
						}
						m[y][x]=' ';
						m[y-1][x]='N';
					}
					else if(n==3 and m[y][x-1]!='#' and m[y][x-1]!='N'){
						if(m[y][x-1]=='C'){
							vita=false;
						}
						m[y][x]=' ';
						m[y][x-1]='N';
					}
					else if(n==1 and flag_1==false and m[y+1][x]!='#'and m[y+1][x]!='N'){
						if(m[y+1][x]=='C'){
							vita=false;
						}
						m[y][x]=' ';
						m[y+1][x]='N';
					}
					else if(n==2 and flag_2==false and m[y][x+1]!='#' and m[y][x+1]!='N'){
						if(m[y][x+1]=='C'){
							vita=false;
						}
						m[y][x]=' ';
						m[y][x+1]='N';
					}
					if(flag_1==false){
						flag_1=true;
					}
					else{
						flag_1=false;
					}
					if(flag_2==false){
						flag_2==true;
					}
					else{
						flag_2==false;
					}
			}
		}
	}
}
main(){
	//Ambiente di gioco
	char m[29][30]={
	'#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#',
	'#','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','#',
	'#','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','#',
	'#','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','#',
	'#','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','#',
	'#','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','#',
	'#','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','#',
	'#','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','#',
	'#','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','#',
	'#','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','#',
	'#','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','#',
	'#','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','#',
	'#','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','#',
	'#','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','#',
	'#','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','N','*','*','*','*','#',
	'#','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','#',
	'#','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','#',
	'#','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','#',
	'#','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','#',
	'#','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','#',
	'#','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','#',
	'#','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','#',
	'#','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','N','*','*','*','*','*','*','*','*','*','*','#',
	'#','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','#',
	'#','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','#',
	'#','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','#',
	'#','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','#',
	'#','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','*','#',
	'#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#',
	};
	char scelta;
	m[14][1]='C';
	system("color 0a");
	cout<<"Istruzioni:"<<endl;
	cout<<"W: Sopra    S: Sotto"<<endl;
	cout<<"A: Sinistra D: Destra"<<endl<<endl;;
	cout<<"Mangia il maggior numero di stelline prima che quelle N maledette te le rubino!. Tu sei la C"<<endl<<endl;
	
	cout << "       ###############			   "<< endl;         
    cout << "      ##################		   "<< endl;       
    cout << "    #######################		   "<< endl;         
    cout << "  ##############   ###########				   "<< endl;
    cout << "##############################				   "<< endl;
    cout << "#######################				   "<< endl;
    cout << "####################			   "<< endl;
    cout << "################			   "<< endl;
    cout << "#############			   "<< endl;
    cout << "###########				   "<< endl;   
    cout << "#########					   "<< endl;
    cout << "############			   "<< "PUCKMAN" << endl;         
    cout << "##################		   "<< endl;       
    cout << "#######################		   "<< endl;         
    cout << "###########################				   "<< endl;
    cout << "##############################				   "<< endl;
    cout << "    #######################				   "<< endl;
    cout << "      ####################			   "<< endl;
    cout << "        ################			   "<< endl;
    cout<<"             8bit game"<<endl;
	system("pause");
	do{
	system("cls");
	stampa(m);
	cin>>scelta;          
	play(m,scelta);
}while(vita==true);
system("cls");                                                                                     
cout<<"Hai perso con "<<points<<" punti"<<endl;
system("pause");
}
